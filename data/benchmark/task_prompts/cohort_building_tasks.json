{
  "category": "cohort_building",
  "description": "Tasks requiring building patient cohorts that span multiple systems",
  "tasks": [
    {
      "task_id": "HDH-COH-001",
      "category": "cohort_building",
      "difficulty": "easy",
      "title": "Single-System Cohort: Diabetics",
      "description": "Find all patients in the EHR with a Type 2 Diabetes diagnosis. Diabetes is coded with ICD-10 codes starting with E11.",
      "systems_required": [
        "ehr"
      ],
      "max_turns": 10,
      "success_criteria": {
        "type": "threshold",
        "target_field": "recall",
        "threshold": 0.9,
        "partial_credit": true
      },
      "grading": {
        "weight": 0.05,
        "sub_goals": [
          {
            "id": "correct_query",
            "description": "Queried conditions correctly",
            "points": 0.4
          },
          {
            "id": "correct_code",
            "description": "Used correct ICD-10 code",
            "points": 0.3
          },
          {
            "id": "complete_list",
            "description": "Found >90% of diabetics",
            "points": 0.3
          }
        ]
      },
      "expected_response": {
        "cohort_name": "Type 2 Diabetics",
        "patient_count": "integer",
        "patient_ids": [
          "array of EHR patient IDs"
        ],
        "query_used": "string describing the query"
      }
    },
    {
      "task_id": "HDH-COH-002",
      "category": "cohort_building",
      "difficulty": "medium",
      "title": "Lab-Based Cohort: Abnormal Glucose",
      "description": "Find all patients who have had at least one abnormal fasting glucose result. Glucose is LOINC code 2345-7. Abnormal is interpretation 'H' (high) or 'L' (low).",
      "systems_required": [
        "lis"
      ],
      "max_turns": 15,
      "success_criteria": {
        "type": "threshold",
        "target_field": "precision",
        "threshold": 0.85
      },
      "grading": {
        "weight": 0.05,
        "sub_goals": [
          {
            "id": "correct_loinc",
            "description": "Used correct LOINC code",
            "points": 0.3
          },
          {
            "id": "filtered_abnormal",
            "description": "Filtered by interpretation",
            "points": 0.4
          },
          {
            "id": "extracted_patients",
            "description": "Extracted unique patients",
            "points": 0.3
          }
        ]
      },
      "expected_response": {
        "cohort_name": "Abnormal Glucose",
        "patient_count": "integer",
        "patient_ids": [
          "array of LIS patient IDs"
        ],
        "abnormal_results": [
          {
            "patient_id": "string",
            "value": "number",
            "unit": "string",
            "interpretation": "H|L",
            "date": "string"
          }
        ]
      }
    },
    {
      "task_id": "HDH-COH-003",
      "category": "cohort_building",
      "difficulty": "hard",
      "title": "Cross-System Cohort: Diabetics on Metformin",
      "description": "Find patients who have BOTH a Type 2 Diabetes diagnosis in the EHR (ICD-10 E11.x) AND an active metformin prescription in the Pharmacy system (RxNorm 860975). This requires matching patients across the two systems.",
      "systems_required": [
        "ehr",
        "pharmacy"
      ],
      "max_turns": 25,
      "success_criteria": {
        "type": "f1_score",
        "target_field": "patient_matches",
        "threshold": 0.7
      },
      "grading": {
        "weight": 0.08,
        "sub_goals": [
          {
            "id": "found_diabetics",
            "description": "Found diabetics in EHR",
            "points": 0.2
          },
          {
            "id": "found_metformin",
            "description": "Found metformin patients in Pharmacy",
            "points": 0.2
          },
          {
            "id": "matched_patients",
            "description": "Matched patients across systems",
            "points": 0.4
          },
          {
            "id": "correct_intersection",
            "description": "Correct intersection",
            "points": 0.2
          }
        ]
      },
      "expected_response": {
        "cohort_name": "Diabetics on Metformin",
        "patient_count": "integer",
        "patients": [
          {
            "ehr_id": "string",
            "pharmacy_id": "string",
            "diabetes_code": "string",
            "metformin_status": "active|stopped"
          }
        ]
      }
    },
    {
      "task_id": "HDH-COH-004",
      "category": "cohort_building",
      "difficulty": "hard",
      "title": "Three-System Cohort: Diabetics with A1C Monitoring",
      "description": "Find patients who: (1) Have Type 2 Diabetes in EHR, (2) Are on metformin in Pharmacy, (3) Have had an HbA1c test (LOINC 4548-4) in the last 6 months in LIS. Return complete patient information from all three systems.",
      "systems_required": [
        "ehr",
        "pharmacy",
        "lis"
      ],
      "max_turns": 35,
      "success_criteria": {
        "type": "f1_score",
        "target_field": "complete_matches",
        "threshold": 0.6
      },
      "grading": {
        "weight": 0.1
      },
      "expected_response": {
        "cohort_name": "Diabetics on Metformin with Recent A1C",
        "patient_count": "integer",
        "patients": [
          {
            "ehr_id": "string",
            "pharmacy_id": "string",
            "lis_id": "string",
            "diabetes_diagnosis": "string",
            "metformin_dose": "string",
            "latest_a1c": {
              "value": "number",
              "date": "string",
              "interpretation": "string"
            }
          }
        ]
      }
    },
    {
      "task_id": "HDH-COH-005",
      "category": "cohort_building",
      "difficulty": "expert",
      "title": "Complex Multi-Criteria Cohort",
      "description": "Find patients meeting ALL criteria: (1) Age 50-70, (2) Diabetes OR Hypertension diagnosis, (3) On at least 2 chronic medications, (4) Had an inpatient encounter in the past year, (5) Have recent lab results. This requires data from EHR, Pharmacy, PAS, and LIS.",
      "systems_required": [
        "ehr",
        "pharmacy",
        "pas",
        "lis"
      ],
      "max_turns": 45,
      "success_criteria": {
        "type": "f1_score",
        "threshold": 0.5
      },
      "grading": {
        "weight": 0.07
      },
      "expected_response": {
        "cohort_name": "Complex Multi-Criteria Cohort",
        "criteria_summary": "string",
        "patient_count": "integer",
        "patients": [
          {
            "patient_ids": {
              "ehr": "string",
              "pharmacy": "string",
              "pas": "string",
              "lis": "string"
            },
            "age": "integer",
            "conditions": [
              "list"
            ],
            "medication_count": "integer",
            "inpatient_encounter_date": "string",
            "recent_labs": [
              "list"
            ]
          }
        ]
      }
    }
  ]
}